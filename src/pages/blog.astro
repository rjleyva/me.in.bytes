---
import { getCollection } from 'astro:content';
import { createMetadata } from '@/utils/metadata';
import BaseLayout from '@/layouts/BaseLayout.astro';
import { generateBlogJsonLd } from '@/utils/jsonld';

const posts = (await getCollection('posts')).sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime()
);

const baseMeta = createMetadata({
  pageTitle: "RJ Leyva's Blog Archive",
  pageDescription: 'Read all articles and learning logs.',
  pageURL: new URL('/blog', Astro.site).toString()
});

const metadata = {
  ...baseMeta,
  structuredData: generateBlogJsonLd(posts, baseMeta)
};
---

<BaseLayout {...metadata}>
  <section class="blog-archive" aria-labelledby="blog-archive__heading">
    <h1 id="blog-archive__heading" class="blog-archive__heading">
      Blog Archive
    </h1>
    <ul class="blog-archive__list">
      {
        posts.map(post => (
          <li class="blog-archive__item">
            <article
              class="blog-archive__post"
              aria-labelledby={`post-title-${post.id}`}
            >
              <h2 id={`post-title-${post.id}`} class="blog-archive__post-title">
                <a class="blog-archive__post-link" href={`/blog/${post.slug}/`}>
                  {post.data.title}
                </a>
              </h2>
              <p class="blog-archive__meta">
                <time lang="en" datetime={post.data.date.toISOString()}>
                  {post.data.date.toLocaleDateString('en-US', {
                    dateStyle: 'long'
                  })}
                </time>
              </p>
              <p class="blog-archive__description">{post.data.description}</p>
            </article>
          </li>
        ))
      }
    </ul>
  </section>
</BaseLayout>

<style>
  .blog-archive {
    margin: 0 auto;
    padding: 1rem;
    max-width: 30rem;
  }

  .blog-archive__heading {
    font-size: 1.5rem;
    margin-bottom: 1rem;
  }

  @media (min-width: 37.5rem) {
    .blog-archive__heading {
      font-size: 1.6rem;
    }
  }

  @media (min-width: 55rem) {
    .blog-archive__heading {
      font-size: 1.7rem;
    }
  }

  .blog-archive__list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    list-style-type: none;
  }

  .blog-archive__post-title {
    font-size: 1rem;
  }

  @media (min-width: 37.5rem) {
    .blog-archive__post-title {
      font-size: 1.1rem;
    }
  }

  @media (min-width: 55rem) {
    .blog-archive__post-title {
      font-size: 1.2rem;
    }
  }

  .blog-archive__description {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .blog-archive__post-link:focus-visible {
    outline: 0.125rem solid var(--bg-hover);
    outline-offset: 0.125rem;
  }
</style>
